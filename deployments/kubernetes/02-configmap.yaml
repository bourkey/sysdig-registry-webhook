apiVersion: v1
kind: ConfigMap
metadata:
  name: scanner-config
  namespace: webhook-scanner
  labels:
    app.kubernetes.io/name: registry-webhook-scanner
    app.kubernetes.io/component: scanner
data:
  config.yaml: |
    server:
      port: 8080
      read_timeout: 30s
      write_timeout: 30s
      max_request_size: 10485760  # 10MB
      shutdown_timeout: 30s

    registries:
      - name: harbor-prod
        type: harbor
        url: https://harbor.example.com
        auth:
          type: bearer
          secret: ${FILE:harbor-webhook-token}
        scanner:
          timeout: 600s
          credentials:
            username: ${FILE:harbor-username}
            password: ${FILE:harbor-password}

      - name: dockerhub
        type: dockerhub
        auth:
          type: hmac
          secret: ${FILE:dockerhub-webhook-secret}

      - name: gitlab-registry
        type: gitlab
        url: https://registry.gitlab.com
        auth:
          type: bearer
          secret: ${FILE:gitlab-webhook-token}
        scanner:
          timeout: 300s
          credentials:
            username: ${FILE:gitlab-username}
            password: ${FILE:gitlab-password}

    scanner:
      sysdig_token: ${FILE:sysdig-api-token}
      cli_path: /usr/local/bin/sysdig-cli-scanner
      default_timeout: 300s
      max_concurrent: 5

    queue:
      buffer_size: 100
      workers: 3
