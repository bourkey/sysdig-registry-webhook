# Registry Webhook Scanner Configuration Example
# Copy this file to config.yaml and customize for your environment

server:
  port: 8080
  read_timeout: 30s
  write_timeout: 30s
  max_request_size: 10485760  # 10MB in bytes
  shutdown_timeout: 30s

registries:
  # Docker Hub configuration
  - name: dockerhub
    type: dockerhub
    auth:
      type: hmac
      secret: ${DOCKERHUB_WEBHOOK_SECRET}  # Set via environment variable

  # Harbor configuration
  - name: harbor-prod
    type: harbor
    url: https://harbor.company.com
    auth:
      type: bearer
      secret: ${HARBOR_WEBHOOK_TOKEN}
    scanner:
      timeout: 600s  # 10 minutes for large images
      credentials:
        username: ${HARBOR_USERNAME}
        password: ${HARBOR_PASSWORD}

  # GitLab Container Registry configuration (with Registry Scanner override)
  - name: gitlab-registry
    type: gitlab
    url: https://registry.gitlab.com
    auth:
      type: bearer
      secret: ${GITLAB_WEBHOOK_TOKEN}
    scanner:
      type: registry  # Override global scanner type for this registry
      timeout: 300s
      credentials:
        username: ${GITLAB_USERNAME}
        password: ${GITLAB_PASSWORD}

scanner:
  # Scanner type: "cli" (default) or "registry"
  # - cli: Uses Sysdig CLI Scanner (downloads images locally)
  # - registry: Uses Sysdig Registry Scanner API (scans images in registry without pulling)
  type: cli

  # Sysdig API token (required for both scanner types)
  sysdig_token: ${SYSDIG_API_TOKEN}

  # CLI Scanner specific settings (used when type=cli)
  cli_path: /usr/local/bin/sysdig-cli-scanner

  # Default timeout for scanner invocation
  default_timeout: 300s  # 5 minutes

  # Maximum concurrent scanner processes
  max_concurrent: 5

  # Registry Scanner specific settings (required when type=registry)
  # Uncomment and configure if using Registry Scanner
  # registry_scanner:
  #   api_url: https://secure.sysdig.com  # Sysdig API endpoint
  #   project_id: ${SYSDIG_PROJECT_ID}    # Sysdig project ID (required)
  #   verify_tls: true                     # Verify TLS certificates (default: true)
  #   poll_interval: 5s                    # How often to poll for scan results (default: 5s)

queue:
  # Event queue buffer size
  buffer_size: 100

  # Number of worker goroutines
  workers: 3

# Environment variables referenced above should be set:
# - DOCKERHUB_WEBHOOK_SECRET
# - HARBOR_WEBHOOK_TOKEN
# - HARBOR_USERNAME
# - HARBOR_PASSWORD
# - GITLAB_WEBHOOK_TOKEN
# - GITLAB_USERNAME
# - GITLAB_PASSWORD
# - SYSDIG_API_TOKEN
# - SYSDIG_PROJECT_ID (required if using Registry Scanner)
